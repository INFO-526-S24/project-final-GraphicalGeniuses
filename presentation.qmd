---
title: "The Timeless Rivalry: Ronaldo vs Messi"
subtitle: "An investigation tracking Messi and Ronaldo's performance trends"
author: 
  - name: "**Graphical Geniuses**: <br> Mobolaji, Narasimha, Pradnya, Praveen, Tushar, Usama"  
title-slide-attributes:
  data-background-image: images/ronaldomessi.jpg
  data-background-size: stretch
  data-background-opacity: "0.7"
  data-slide-number: none
format:
  revealjs:
    theme: league
    transition: slide
    background-transition: fade
editor: visual
execute:
  echo: false
---

```{r}
#| label: load-packages
#| message: false
#| include: false

# Load packages here
pacman::p_load(tidymodels,
               tidyverse)

```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
```

```{r}
#| label: load-data
#| message: false
#| echo: false
#| results: hide
# Load data here

#| fig-width: 15
#| fig-height: 15

pacman::p_load(tidyverse, readr, stringr, sf, "rnaturalearth", "rnaturalearthdata", "ggspatial", ggh4x, "ggthemes")


ronaldo <- read_csv("data/cr7.csv")
messi <- read_csv("data/messi.csv")

ronaldo <- ronaldo %>%
  mutate(
    Year = paste0("20", str_sub(Date, -2, -1))
)

messi <- messi %>%
  mutate(
    Year = paste0("20", str_sub(Date, -2, -1))
)

ronaldo <- ronaldo %>%
  filter(Season != "02/03" & Season != "03/04")


# RETRIEVE GEOMETRIES OF WORLD AND EUROPE
world <- ne_countries(scale = "medium", returnclass = "sf")
europe <- ne_countries(scale = "medium", returnclass = "sf", continent = "europe")


combinedMessiRonaldo <- bind_rows(ronaldo,messi, .id = "Player")

combinedMessiRonaldo <- combinedMessiRonaldo %>%
  mutate(Player = case_when(
    Player == 1 ~ "Ronaldo",
    Player == 2 ~ "Messi"
  ))

combinedCopy <- combinedMessiRonaldo
```

```{r}

#| label: load-data
#| message: false
#| echo: false
#| results: hide
#| fig-width: 15
#| fig-height: 15

# LINK OPPOSING TEAMS TO THEIR COUNTRIES
countries <- data.frame(coun = c('Moreirense FC - Portugal',
               'Boavista FC - Portugal',
               'CD Estarreja - Portugal',
               'FC Oliveira do Hospital - Portugal',
               'Portsmouth FC - England',
               'Manchester City - England',
               'Tottenham Hotspur - England',
               'Birmingham City - England',
               'Aston Villa - England',
               'Millwall FC - England',
               'Southampton FC - England',
               'Exeter City - England',
               'Arsenal FC - England',
               'Everton FC - England',
               'Fulham FC - England',
               'Newcastle United - England',
               'Debreceni VSC - Hungary',
               'Middlesbrough FC - England',
               'West Bromwich Albion - England',
               'Bolton Wanderers - England',
               'Wigan Athletic - England',
               'Charlton Athletic - England',
               'Reading FC - England',
               'Watford FC - England',
               'AS Roma - Italy',
               'AC Milan - Italy',
               'Sporting CP - Portugal',
               'Dynamo Kyiv - Ukraine',
               'Blackburn Rovers - England',
               'Derby County - England',
               'Sunderland AFC - England',
               'West Ham United - England',
               'Olympique Lyon - France',
               'Liverpool FC - England',
               'Chelsea FC - England',
               'Hull City - England',
               'Stoke City - England',
               'Gamba Osaka - Japan',
               'FC Internazionale - Italy',
               'FC Porto - Portugal',
               'Deportivo de La Coruña - Spain',
               'RCD Espanyol Barcelona - Spain',
               'FC Zürich - Switzerland',
               'Xerez CD - Spain',
               'Villarreal CF - Spain',
               'Olympique Marseille - France',
               'UD Almería - Spain',
               'Real Zaragoza - Spain',
               'Malaga CF - Spain',
               'CD Tenerife - Spain',
               'Sevilla FC - Spain',
               'Real Valladolid CF - Spain',
               'Getafe CF - Spain',
               'Racing Santander - Spain',
               'Valencia CF - Spain',
               'CA Osasuna - Spain',
               'RCD Mallorca - Spain',
               'Athletic Bilbao - Spain',
               'Hercules CF - Spain',
               'Real Murcia CF - Spain',
               'Ajax Amsterdam - Netherlands',
               'AJ Auxerre - France',
               'Levante UD - Spain',
               'Atletico de Madrid - Spain',
               'Real Sociedad - Spain',
               'FC Barcelona - Spain',
               'Rayo Vallecano - Spain',
               'Sporting Gijón - Spain',
               'SD Ponferradina - Spain',
               'Granada CF - Spain',
               'CSKA Moscow - Russia',
               'Real Betis Balompie - Spain',
               'APOEL Nicosia - Cyprus',
               'Bayern Munich - Germany',
               'Celta de Vigo - Spain',
               'Borussia Dortmund - Germany',
               'Manchester United - England',
               'Galatasaray - Turkey',
               'Elche CF - Spain',
               'FC Copenhagen - Denmark',
               'Juventus FC - Italy',
               'FC Schalke 04 - Germany',
               'Córdoba CF - Spain',
               'FC Basel 1893 - Switzerland',
               'Ludogorets Razgrad - Bulgaria',
               'SD Eibar - Spain',
               'Shakhtar Donetsk - Ukraine',
               'Malmö FF - Sweden',
               'UD Las Palmas - Spain',
               'VfL Wolfsburg - Germany',
               'Deportivo Alaves - Spain',
               'CF America - Mexico',
               'Kashima Antlers - Japan',
               'Al-Jazira (Abu Dhabi) - United Arab Emirates',
               'Grêmio Foot-Ball Porto Alegrense - Brazil',
               'Paris Saint-Germain - France',
               'Girona FC - Spain',
               'US Sassuolo - Italy',
               'Frosinone Calcio - Italy',
               'Udinese Calcio - Italy',
               'Genoa CFC - Italy',
               'Empoli FC - Italy',
               'SPAL - Italy',
               'ACF Fiorentina - Italy',
               'Torino FC - Italy',
               'Atalanta BC - Italy',
               'UC Sampdoria - Italy',
               'SS Lazio - Italy',
               'Parma Calcio 1913 - Italy',
               'Inter Milan - Italy',
               'SSC Napoli - Italy',
               'Hellas Verona - Italy',
               'Bayer 04 Leverkusen - Germany',
               'Bologna FC 1909 - Italy',
               'Cagliari Calcio - Italy',
               'US Lecce - Italy',
               'Spezia Calcio - Italy',
               'Ferencvarosi TC - Hungary',
               'FC Crotone - Italy',
               'BSC Young Boys - Switzerland',
               'Norwich City - England',
               'Burnley FC - England',
               'Brighton & Hove Albion - England',
               'Brentford FC - England',
               'FC Sheriff - Moldova',
               'Albacete Balompie - Spain',
               'Panathinaikos Athens - Greece',
               'SV Werder Bremen - Germany',
               'Real Madrid - Spain',
               'Recreativo Huelva - Spain',
               'Deportivo de La Coruña - Spain',
               'Gimnastic de Tarragona - Spain',
               'VfB Stuttgart - Germany',
               'UD Almería - Spain',
               'Rangers FC - Scotland',
               'Celtic FC - Scotland',
               'Benidorm CD - Spain',
               'CD Numancia - Spain',
               'Cultural Leonesa - Spain',
               'CF Atlante - Mexico',
               'Club Estudiantes de La Plata - Argentina',
               'Club Atletico de Ceuta - Spain',
               'BATE Borisov - Belarus',
               'FC Viktoria Plzen - Czech Republic',
               'Santos FC - Brazil',
               'Spartak Moscow - Russia',
               'CA River Plate - Argentina',
               'CD Leganes - Spain',
               'Borussia Mönchengladbach - Germany',
               'Olympiacos Piraeus - Greece',
               'SD Huesca - Spain',
               'PSV Eindhoven - Netherlands',
               'SK Slavia Prague - Czech Republic',
               'Cadiz CF - Spain',
               'RB Leipzig - Germany',
               'FC Nantes - France',
               'Club Brugge KV - Belgium',
               'LOSC Lille - France',
               'FC Lorient - France',
               'RC Lens - France',
               'Montpellier - France',
               'Clermont Foot - France',
               'Maccabi Haifa - Israel',
               'OGC Nice - France',
               'SL Benfica - Portugal',
               'AC Ajaccio - France',
               'ESTAC Troyes - France'
)) 


countries <- separate(countries, coun, into = c("Opponent", "Country"), sep = " - ")


# MATCH TEAMS SCORED AGAINSTS TO COUNTRIES 
combinedMessiRonaldo <- left_join(combinedMessiRonaldo, countries, by = "Opponent")
combinedCopy <- left_join(combinedCopy, countries, by = "Opponent")


combinedMessiRonaldo <- combinedMessiRonaldo %>%
  mutate(Country = case_when(
    Country == "England" ~ "United Kingdom",
    Country == "Wales" ~ "United Kingdom",
    Country == "Scotland" ~ "United Kingdom",
    Country == "Czech Republic" ~ "Czechia",
    T ~ Country
  ))


# ADD COUNTRY GEOMETRIES TO COUNTRIES SCORED AGAINST
worldMergedWithMessiRonaldo <- left_join(combinedMessiRonaldo, world, by = c("Country" = "geounit"))
europeMergedWithMessiRonaldo <- inner_join(combinedMessiRonaldo, europe, by = c("Country" = "geounit"))

worldMerged <- worldMergedWithMessiRonaldo %>%
  filter(!is.na(Country)) %>%
  select(c(1:16, 20, 184))

europeMerged <- europeMergedWithMessiRonaldo %>%
  filter(!is.na(Country)) %>%
  select(c(1:16, 20, 184))

mapTestingCode <- ggplot() +
  geom_sf(data = world, aes(geometry = geometry)) +
  geom_sf(data = worldMerged, aes(geometry = geometry, fill = is.na(Player))) +
  theme_minimal() +
  theme() +
  scale_fill_manual(values = c("gold", "azure"))

mapTestingCode2 <- ggplot() +
  geom_sf(data = europe, aes(geometry = geometry)) +
  geom_sf(data = europeMerged, aes(geometry = geometry, fill = is.na(Player))) +
  theme_minimal() +
  theme() +
  scale_fill_manual(values = c("gold", "azure"))
```

## Introduction {.smaller}

::: incremental
-   The ultimate goal of the project is to compare and contrast the performances of Cristiano Ronaldo and Lionel Messi, only, over time and space (season / country respectively), primarily via geographical plots.

-   The datasets, compiled by Azmine Toushik Wasi and sourced from Kaggle, provides a detailed insight into the performances of two legendary footballers: Cristiano Ronaldo and Lionel Messi. These datasets offer a comprehensive view of their contributions across various seasons, competitions, matches, and events.

    -   `ronaldo.csv`: It has 13 variables such as season, competition, result, opponent etc. In total, it has 701 rows indicating the 701 goals scored by Cristiano Ronaldo up until 2022.

    -   `messi.csv`: It has the same 13 variables such as season, competition, result, opponent etc. In total, it has 698 rows indicating the 698 goals scored by Lionel Messi up until 2022.
:::

## Approach {.smaller}

::: incremental
-   First, we created animations using gganimate. It shows the world map highlighting countries where Messi and Ronaldo scored goals for a particular year over the period from 2005 to 2022. It also displays total number of goals scored by each player in all matches in that year

-   Then, using CSS, HTML we created comparison plots between Messi and Ronaldo's scores which can be filtered and displayed based on various factors like Country, Competition, Opponent, Match Day, Last Minute Goals.
:::

# The Legacy: Ronaldo Vs Messi

## Animations

```{r}

#| label: Animations
#| message: false
#| echo: false
#| results: hide

#| fig-asp: 0.618
#| fig-width: 20

pacman:: p_load(gganimate, plotly, maps, ggthemes, ggrepel, av, rworldmap, gifski)

# UNUSED ANIMATION
simpleAnimationOne <- ggplot() +
  geom_sf(data = world, aes(geometry = geometry)) + 
  theme_minimal()+ 
  geom_sf(data = worldMerged, aes(geometry = geometry, fill = Player)) +
  facet_wrap2(vars(Player), nrow = 2) +
  ggtitle("Year: {closest_state}") +
  theme(legend.position = "none") +
  transition_states(Year, transition_length = 1, state_length = 5, T) 

#anim <- anim + enter_fade() + exit_fade()
#animate(anim, renderer = av_renderer("out.mp4"), height = 800, width = 1000, res = 500)





# SUMMARISE GOALS SCORED AND COUNTRIES SCORED AGAINST
worldSquashed <- worldMerged %>%
  group_by(Year, Country, Player, geometry) %>%
  summarise(goals = n())


europeSquashed <- europeMerged %>%
  group_by(Year, Country, Player, geometry) %>%
  summarise(goals = n())



# DID RONALDO AND MESSI SCORE IN SAME COUNTRY IN SAME YEAR?
worldSquashed2 <- worldSquashed %>%
  group_by(Year, Country )%>%
  mutate(plays = n()) %>%
  mutate(colr = case_when(
    Player == "Messi" & plays == 1 ~ "Messi",
    Player == "Ronaldo" & plays == 1 ~ "Ronaldo",
    plays == 2 ~ "Both",
    T ~ "Neither"
  ))

europeSquashed2 <- europeSquashed %>%
  group_by(Year, Country )%>%
  mutate(plays = n()) %>%
  mutate(colr = case_when(
    Player == "Messi" & plays == 1 ~ "Messi",
    Player == "Ronaldo" & plays == 1 ~ "Ronaldo",
    plays == 2 ~ "Both",
    T ~ "Neither"
  ))


worldSquashed3 <- worldSquashed2 %>%
  filter(colr == "Both")

europeSquashed3 <- europeSquashed2 %>%
  filter(colr == "Both")
```

```{r}
#| label: Animations
#| message: false
#| echo: false
#| results: hide


#TO RETRIEVE CENTER POINTS FOR COUNTRY LABELS
countryDataJoinedToMap <- suppressMessages(joinCountryData2Map(combinedCopy, joinCode = "NAME", nameJoinColumn = "Country", verbose = F))
country_coord <- data.frame(coordinates(countryDataJoinedToMap), stringsAsFactors = FALSE)
country_coord2 <- country_coord %>%
  mutate(country = row.names(country_coord))
```

## Animations

## Discussion

::: incremental
-   In year 2012 Messi scored highest goals of 74 whereas in 2013, Ronaldo scored highest goals of 58.

-   Both players scored higher goals compared to the other for 8 years each.

-   Messi scored higher goals than Ronaldo in years viz. 2009-2010, 2012, 2016-2019, 2022 whereas Ronaldo scored higher than Messi in the years 2005-2008,2013-2015, 2020

-   The total goals scored by Messi in there years are 652 whereas goals scored by Ronaldo in the same period are 654.

-   So the performance of both players looks almost comparable in terms of goals scored with Ronaldo scoring marginally higher total scores than Messi
:::

# The Rivalry: Ronaldo Vs Messi

## Comparison
